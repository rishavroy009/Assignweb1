<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClearKey EME Test</title>
</head>
<body>
    <video id="video" controls width="640" height="360"></video>

    <script>
        const video = document.getElementById('video');

        // ClearKey configuration (use actual base64 encoded keys and KIDs)
        const config = [{
            initDataTypes: ['keyids'],
            videoCapabilities: [{ contentType: 'video/mp4; codecs="avc1.42E01E"' }]
        }];

        // Base64 encoded key and key ID
        const key = 'YOUR_BASE64_ENCODED_KEY'; // Replace with actual key
        const keyId = 'YOUR_BASE64_ENCODED_KEY_ID'; // Replace with actual key ID

        const clearKey = {
            "keys": [{
                "kty": "oct",
                "k": key,
                "kid": keyId
            }]
        };

        // Convert JSON to string and then to base64 for the ClearKey
        const clearKeyData = btoa(JSON.stringify(clearKey));

        // Request ClearKey key system access
        navigator.requestMediaKeySystemAccess('org.w3.clearkey', config)
            .then(keySystemAccess => {
                return keySystemAccess.createMediaKeys();
            })
            .then(mediaKeys => {
                return video.setMediaKeys(mediaKeys);
            })
            .then(() => {
                // Provide ClearKey to the MediaKeySession
                const session = video.mediaKeys.createSession();

                session.addEventListener('message', event => {
                    // When the browser requests keys, respond with ClearKey
                    session.update(new Uint8Array(clearKeyData).buffer);
                });

                // Initialize the media session with key ID
                const keyIdArray = new Uint8Array(atob(keyId).split('').map(char => char.charCodeAt(0)));
                session.generateRequest('keyids', keyIdArray.buffer);

                // Set the video source
                video.src = 'YOUR_VIDEO_URL'; // Replace with your MP4 DASH video URL
                video.play();
            })
            .catch(error => {
                console.error('EME error:', error);
            });
    </script>
</body>
</html>
