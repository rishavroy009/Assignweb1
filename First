// 1. Create a MediaKeySession
const keySystem = 'com.microsoft.playready'; // Use ClearKey for ClearKey
const mediaKeySession = new MediaKeySession();

// 2. Generate a request with initialization data
const initData = new Uint8Array([/* Your initialization data */]);
mediaKeySession.generateRequest('cenc', initData).then(() => {
    console.log("Key request sent to the server.");
}).catch((error) => {
    console.error("Error generating request: ", error);
});

// 3. Listen for the keyneeded event
mediaKeySession.addEventListener('keyneeded', (event) => {
    const keyId = event.keyId; // The key ID that is needed
    console.log("Key needed: ", keyId);

    // 4. Fetch the key from the server
    fetch(`https://your-license-server.com/getKey?keyId=${keyId}`)
        .then(response => response.json())
        .then(data => {
            // 5. Provide the key back to the mediaKeySession
            mediaKeySession.update(data.key).then(() => {
                console.log("Key successfully updated.");
            }).catch((error) => {
                console.error("Error updating key: ", error);
            });
        })
        .catch((error) => {
            console.error("Error fetching key from server: ", error);
        });
});
